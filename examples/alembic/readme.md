# Alembic Interoperability

The following steps were used to generate the migration.

1. Run `alembic init alembic`
2. Modify [alemnbic.ini](alembic.ini) `driver://user:pass@localhost/dbname`
   to `sqlite:///:memory:` to use an in-memory SQLite database.
3. Modify [env.py](alembic/env.py) by adding `import open_alchemy` at the
   bottom of the import section and
   `open_alchemy.init_yaml(spec_filename="../app/api.yaml")` below that to load
   the SQLAlchemy models for the example [app](../app).
4. Modify [env.py](alembic/env.py) by changing `target_metadata = None` to
   `target_metadata = open_alchemy.models.Base.metadata`
5. Run `alembic revision --autogenerate -m "Add emplpoyee table"` to generate
   the [revision](alembic/versions)

The below shows you the diff from the default code generated by alembic:

```diff
diff --git a/alembic.ini b/alembic.ini
index bfcc3c7..f65a55d 100644
--- a/alembic.ini
+++ b/alembic.ini
@@ -35,7 +35,7 @@ script_location = alembic
 # are written from script.py.mako
 # output_encoding = utf-8

-sqlalchemy.url = driver://user:pass@localhost/dbname
+sqlalchemy.url = sqlite:///:memory:


 [post_write_hooks]
diff --git a/alembic/env.py b/alembic/env.py
index c58b79f..71f8edf 100644
--- a/alembic/env.py
+++ b/alembic/env.py
@@ -4,6 +4,10 @@ from alembic import context
 from sqlalchemy import engine_from_config
 from sqlalchemy import pool

+import open_alchemy
+
+open_alchemy.init_yaml(spec_filename="../app/api.yaml")
+
 # this is the Alembic Config object, which provides
 # access to the values within the .ini file in use.
 config = context.config
@@ -16,7 +20,7 @@ fileConfig(config.config_file_name)
 # for 'autogenerate' support
 # from myapp import mymodel
 # target_metadata = mymodel.Base.metadata
-target_metadata = None
+target_metadata = open_alchemy.models.Base.metadata

 # other values from the config, defined by the needs of env.py,
 # can be acquired:
```
